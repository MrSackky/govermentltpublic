{"ast":null,"code":"var _jsxFileName = \"D:\\\\govermentlt\\\\pages\\\\admin\\\\management\\\\polls\\\\index.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { Button, Input, Modal, notification, Table, Typography } from 'antd';\nimport Link from 'next/link';\nimport Router from 'next/router'; // import UserNav from '../components/navigation/User';\n\nimport { useEffect, useState } from 'react';\n/* components */\n\nimport Layout from '../../../../components/layout/LayoutAdmin';\n/* utils */\n\nimport { absoluteUrl, apiInstance, convertDateDBtoDatePickerNoTime, convertDatetoThaiDate } from '../../../../middleware/utils';\nconst {\n  Text,\n  Title\n} = Typography;\nconst {\n  TextArea,\n  Search\n} = Input;\nexport default function Home(props) {\n  const [api, contextHolder] = notification.useNotification();\n  const {\n    user,\n    origin\n  } = props;\n  const {\n    0: login,\n    1: setLogin\n  } = useState(null);\n  const {\n    0: shouldRun,\n    1: setShouldRun\n  } = useState(true);\n  const {\n    0: data,\n    1: setData\n  } = useState([]);\n  const {\n    0: loading,\n    1: setLoading\n  } = useState(false);\n  const {\n    0: search,\n    1: setSearch\n  } = useState('');\n  const {\n    0: visibleModalDelete,\n    1: setVisibleModalDelete\n  } = useState(false);\n  const {\n    0: dataDelete,\n    1: setDataDelete\n  } = useState(null);\n  const {\n    0: filters,\n    1: setFilters\n  } = useState(null);\n  const {\n    0: pagination,\n    1: setPagination\n  } = useState({\n    current: 1,\n    pageSize: 10\n  });\n  const columns = [{\n    title: 'วันที่',\n    dataIndex: '',\n    sorter: true,\n    key: 'date_created',\n    render: data => __jsx(React.Fragment, null, __jsx(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 48,\n        columnNumber: 11\n      }\n    }, ' ', convertDatetoThaiDate(convertDateDBtoDatePickerNoTime(data.date_created)), ' ')) // render: name => `${name.first} ${name.last}`,\n    // width: '20%',\n    // defaultSortOrder: 'descend',\n\n  }, {\n    title: 'หัวข้อแบบสำรวจความคิดเห็น',\n    dataIndex: 'poll_title',\n    sorter: true // render: name => `${name.first} ${name.last}`,\n    // width: '20%',\n    // defaultSortOrder: 'descend',\n\n  }, // {\n  //   title: 'ผลสำรวจ',\n  //   dataIndex: '',\n  //   sorter: true,\n  //   // render: name => `${name.first} ${name.last}`,\n  //   // width: '20%',\n  //   // defaultSortOrder: 'descend',\n  // },\n  {\n    title: 'ช่วงที่เปิดให้แสดงความคิดเห็น',\n    dataIndex: '',\n    sorter: true,\n    render: data => __jsx(React.Fragment, null, __jsx(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 11\n      }\n    }, convertDatetoThaiDate(convertDateDBtoDatePickerNoTime(data.poll_date_s))), __jsx(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 11\n      }\n    }, \" \\u0E16\\u0E36\\u0E07 \"), __jsx(\"span\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 11\n      }\n    }, convertDatetoThaiDate(convertDateDBtoDatePickerNoTime(data.poll_date_e)))) // render: name => `${name.first} ${name.last}`,\n    // width: '20%',\n    // defaultSortOrder: 'descend',\n\n  }, {\n    title: '',\n    dataIndex: '',\n    key: 'x',\n    render: data => __jsx(React.Fragment, null, __jsx(Button, {\n      type: \"primary\",\n      size: 'default',\n      onClick: () => gotoPage(data.poll_id),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }\n    }, 'ดูผลสำรวจ/แก้ไข'), __jsx(Button, {\n      className: \"ml-1\",\n      type: \"danger\",\n      onClick: () => showModal(data),\n      size: 'default',\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 11\n      }\n    }, 'ลบ'))\n  }];\n\n  const gotoPage = id => {\n    console.log(id);\n    Router.push('/admin/management/polls/' + id);\n  };\n\n  useEffect(() => {\n    var _filters = [];\n    pagination.filters = _filters;\n    fetch({\n      pagination\n    });\n  }, []);\n\n  const handleTableChange = (pagination, filters, sorter) => {\n    console.log(sorter);\n    setPagination({\n      pageSize: pagination.pageSize,\n      current: pagination.current\n    });\n    setFilters(filters.package);\n    fetch({\n      sortField: sorter.columnKey,\n      sortOrder: sorter.order,\n      pagination,\n      filters: filters.package\n    });\n  };\n\n  const onSearch = async _search => {\n    setLoading(true);\n    setSearch(_search);\n    setPagination({\n      pageSize: pagination.pageSize,\n      current: 1\n    });\n    const addactivitiesData = await apiInstance().get('poll?organization_id=' + (user ? user.organization_id : 0) + '&results=' + pagination.pageSize + '&page=1&search=' + _search + '&filters=' + filters);\n    setData(addactivitiesData.data.results);\n    setLoading(false);\n  };\n\n  const fetch = async (params = {}) => {\n    setLoading(true);\n    const addactivitiesData = await apiInstance().get('poll?organization_id=' + (user ? user.organization_id : 0) + '&results=' + params.pagination.pageSize + '&page=' + params.pagination.current + '&search=' + search + '&sortField=' + params.sortField + '&sortOrder=' + params.sortOrder + '&filters=' + params.filters);\n    setData(addactivitiesData.data.results);\n    setPagination(_objectSpread(_objectSpread({}, params.pagination), {}, {\n      total: addactivitiesData.data.totalCount // 200 is mock data, you should read it from server\n      // total: data.totalCount,\n\n    }));\n    setLoading(false);\n  };\n\n  const showModal = data => {\n    console.log('data deleted');\n    console.log(data);\n    setDataDelete(data);\n    setVisibleModalDelete(true);\n  };\n\n  const hideModal = () => {\n    setVisibleModalDelete(false);\n  };\n\n  const onDeleteOrganization = async () => {\n    // console.log('DELETE')\n    // const data = {\n    //   'organization_name': value.organization_name,\n    // }\n    // console.log(data)\n    const registerData = await apiInstance().delete('poll/' + dataDelete.poll_id, {});\n\n    if (registerData.data.status == 200) {\n      openNotificationSuccess(); // fetchOrganizationData();\n\n      setVisibleModalDelete(false);\n      fetch({\n        pagination\n      });\n    } else {\n      openNotificationFail(registerData.data.message);\n    }\n  };\n\n  const openNotificationSuccess = () => {\n    api.success({\n      message: `ลบข้อมูลสำเร็จ`,\n      description: 'ลบข้อมูลสำเร็จ',\n      placement: 'topRight'\n    });\n  };\n\n  const openNotificationFail = messgae => {\n    api.error({\n      message: `พบปัญหาระหว่างการบันทึกข้อมูล`,\n      description: messgae,\n      placement: 'topRight'\n    });\n  };\n\n  return __jsx(Layout, {\n    key: 'home-poll',\n    titlePage: 'จัดการสำรวจความคิดเห็น',\n    title: \"Government - Admin management\",\n    url: origin,\n    origin: origin,\n    isMain: true,\n    indexSubMenu: '1',\n    indexMenu: 'sub-1-6',\n    user: login,\n    props: props,\n    _routes: [{\n      path: '/admin/dashborad',\n      breadcrumbName: 'หน้าหลัก'\n    }, {\n      path: '/admin/management/polls',\n      breadcrumbName: 'จัดการสำรวจความคิดเห็น'\n    }],\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 5\n    }\n  }, __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 268,\n      columnNumber: 7\n    }\n  }, contextHolder, __jsx(\"div\", {\n    className: \"w-full lg:inline-flex justify-between\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 270,\n      columnNumber: 9\n    }\n  }, __jsx(\"div\", {\n    className: \"w-full lg:w-1/2 py-2 justify-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 11\n    }\n  }, __jsx(Link, {\n    href: \"/admin/management/polls/add-poll\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 13\n    }\n  }, __jsx(\"a\", {\n    //onClick={(e) => handleLogout(e)}\n    className: \"lg:inline-flex lg:w-auto px-2 py-2 rounded h-8 text-white bg-green-600 font-bold items-center justify-center hover:bg-green-600 hover:text-white\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 273,\n      columnNumber: 15\n    }\n  }, \"\\u0E40\\u0E1E\\u0E34\\u0E48\\u0E21\\u0E2A\\u0E33\\u0E23\\u0E27\\u0E08\\u0E04\\u0E27\\u0E32\\u0E21\\u0E04\\u0E34\\u0E14\\u0E40\\u0E2B\\u0E47\\u0E19\"))), __jsx(\"div\", {\n    className: \"text-right w-full justify-items-end lg:w-auto py-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 11\n    }\n  }, __jsx(Search, {\n    placeholder: \"input search text\",\n    onSearch: onSearch,\n    enterButton: true,\n    allowClear: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 282,\n      columnNumber: 13\n    }\n  }))), __jsx(Table, {\n    columns: columns,\n    rowKey: record => record.poll_id,\n    dataSource: data,\n    pagination: pagination,\n    loading: loading,\n    onChange: handleTableChange,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 9\n    }\n  })), __jsx(Modal, {\n    title: \"\\u0E04\\u0E38\\u0E13\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\\u0E25\\u0E1A\\u0E02\\u0E49\\u0E2D\\u0E21\\u0E39\\u0E25\\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E44\\u0E21\\u0E48?\",\n    visible: visibleModalDelete,\n    onOk: onDeleteOrganization,\n    onCancel: hideModal,\n    okText: \"\\u0E25\\u0E1A\",\n    cancelText: \"\\u0E22\\u0E01\\u0E40\\u0E25\\u0E34\\u0E01\",\n    okButtonProps: {\n      type: 'primary',\n      danger: true\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 300,\n      columnNumber: 7\n    }\n  }, __jsx(\"p\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 312,\n      columnNumber: 9\n    }\n  }, \"\\u0E04\\u0E38\\u0E13\\u0E15\\u0E49\\u0E2D\\u0E07\\u0E01\\u0E32\\u0E23\\u0E25\\u0E1A \\\"\", dataDelete ? dataDelete.poll_title : '', \"\\\" \\u0E2B\\u0E23\\u0E37\\u0E2D\\u0E44\\u0E21\\u0E48?\", ' ')));\n}\n/* getServerSideProps */\n\nexport async function getServerSideProps(context) {\n  const {\n    req\n  } = context;\n  const {\n    origin\n  } = absoluteUrl(req);\n  return {\n    props: {\n      origin\n    }\n  };\n}","map":{"version":3,"sources":["D:/govermentlt/pages/admin/management/polls/index.js"],"names":["Button","Input","Modal","notification","Table","Typography","Link","Router","useEffect","useState","Layout","absoluteUrl","apiInstance","convertDateDBtoDatePickerNoTime","convertDatetoThaiDate","Text","Title","TextArea","Search","Home","props","api","contextHolder","useNotification","user","origin","login","setLogin","shouldRun","setShouldRun","data","setData","loading","setLoading","search","setSearch","visibleModalDelete","setVisibleModalDelete","dataDelete","setDataDelete","filters","setFilters","pagination","setPagination","current","pageSize","columns","title","dataIndex","sorter","key","render","date_created","poll_date_s","poll_date_e","gotoPage","poll_id","showModal","id","console","log","push","_filters","fetch","handleTableChange","package","sortField","columnKey","sortOrder","order","onSearch","_search","addactivitiesData","get","organization_id","results","params","total","totalCount","hideModal","onDeleteOrganization","registerData","delete","status","openNotificationSuccess","openNotificationFail","message","success","description","placement","messgae","error","path","breadcrumbName","record","type","danger","poll_title","getServerSideProps","context","req"],"mappings":"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","sourcesContent":["import {\r\n  Button, Input,\r\n  Modal,\r\n  notification, Table,\r\n  Typography\r\n} from 'antd';\r\nimport Link from 'next/link';\r\nimport Router from 'next/router';\r\n// import UserNav from '../components/navigation/User';\r\nimport { useEffect, useState } from 'react';\r\n/* components */\r\nimport Layout from '../../../../components/layout/LayoutAdmin';\r\n/* utils */\r\nimport {\r\n  absoluteUrl,\r\n  apiInstance,\r\n  convertDateDBtoDatePickerNoTime,\r\n  convertDatetoThaiDate\r\n} from '../../../../middleware/utils';\r\n\r\nconst { Text, Title } = Typography;\r\n\r\nconst { TextArea, Search } = Input;\r\n\r\nexport default function Home(props) {\r\n  const [api, contextHolder] = notification.useNotification();\r\n  const { user, origin } = props;\r\n  const [login, setLogin] = useState(null);\r\n  const [shouldRun, setShouldRun] = useState(true);\r\n  const [data, setData] = useState([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [search, setSearch] = useState('');\r\n  const [visibleModalDelete, setVisibleModalDelete] = useState(false);\r\n  const [dataDelete, setDataDelete] = useState(null);\r\n  const [filters, setFilters] = useState(null);\r\n  const [pagination, setPagination] = useState({\r\n    current: 1,\r\n    pageSize: 10,\r\n  });\r\n  const columns = [\r\n    {\r\n      title: 'วันที่',\r\n      dataIndex: '',\r\n      sorter: true,\r\n      key: 'date_created',\r\n      render: data => (\r\n        <>\r\n          <span>\r\n            {' '}\r\n            {convertDatetoThaiDate(\r\n              convertDateDBtoDatePickerNoTime(data.date_created),\r\n            )}{' '}\r\n          </span>\r\n        </>\r\n      ),\r\n      // render: name => `${name.first} ${name.last}`,\r\n      // width: '20%',\r\n      // defaultSortOrder: 'descend',\r\n    },\r\n    {\r\n      title: 'หัวข้อแบบสำรวจความคิดเห็น',\r\n      dataIndex: 'poll_title',\r\n      sorter: true,\r\n      // render: name => `${name.first} ${name.last}`,\r\n      // width: '20%',\r\n      // defaultSortOrder: 'descend',\r\n    },\r\n    // {\r\n    //   title: 'ผลสำรวจ',\r\n    //   dataIndex: '',\r\n    //   sorter: true,\r\n    //   // render: name => `${name.first} ${name.last}`,\r\n    //   // width: '20%',\r\n    //   // defaultSortOrder: 'descend',\r\n    // },\r\n    {\r\n      title: 'ช่วงที่เปิดให้แสดงความคิดเห็น',\r\n      dataIndex: '',\r\n      sorter: true,\r\n      render: data => (\r\n        <>\r\n          <span>\r\n            {convertDatetoThaiDate(\r\n              convertDateDBtoDatePickerNoTime(data.poll_date_s),\r\n            )}\r\n          </span>\r\n          <span> ถึง </span>\r\n          <span>\r\n            {convertDatetoThaiDate(\r\n              convertDateDBtoDatePickerNoTime(data.poll_date_e),\r\n            )}\r\n          </span>\r\n        </>\r\n      ),\r\n      // render: name => `${name.first} ${name.last}`,\r\n      // width: '20%',\r\n      // defaultSortOrder: 'descend',\r\n    },\r\n    {\r\n      title: '',\r\n      dataIndex: '',\r\n      key: 'x',\r\n      render: data => (\r\n        <>\r\n          <Button\r\n            type=\"primary\"\r\n            size={'default'}\r\n            onClick={() => gotoPage(data.poll_id)}\r\n          >\r\n            {'ดูผลสำรวจ/แก้ไข'}\r\n          </Button>\r\n          <Button\r\n            className=\"ml-1\"\r\n            type=\"danger\"\r\n            onClick={() => showModal(data)}\r\n            size={'default'}\r\n          >\r\n            {'ลบ'}\r\n          </Button>\r\n        </>\r\n      ),\r\n    },\r\n  ];\r\n  const gotoPage = id => {\r\n    console.log(id);\r\n    Router.push('/admin/management/polls/' + id);\r\n  };\r\n\r\n  useEffect(() => {\r\n    var _filters = [];\r\n    pagination.filters = _filters;\r\n    fetch({ pagination });\r\n  }, []);\r\n\r\n  const handleTableChange = (pagination, filters, sorter) => {\r\n    console.log(sorter);\r\n    setPagination({\r\n      pageSize: pagination.pageSize,\r\n      current: pagination.current,\r\n    });\r\n    setFilters(filters.package);\r\n    fetch({\r\n      sortField: sorter.columnKey,\r\n      sortOrder: sorter.order,\r\n      pagination,\r\n      filters: filters.package,\r\n    });\r\n  };\r\n  const onSearch = async _search => {\r\n    setLoading(true);\r\n    setSearch(_search);\r\n    setPagination({\r\n      pageSize: pagination.pageSize,\r\n      current: 1,\r\n    });\r\n    const addactivitiesData = await apiInstance().get(\r\n      'poll?organization_id=' +\r\n      (user ? user.organization_id : 0) +\r\n      '&results=' +\r\n      pagination.pageSize +\r\n      '&page=1&search=' +\r\n      _search +\r\n      '&filters=' +\r\n      filters,\r\n    );\r\n\r\n    setData(addactivitiesData.data.results);\r\n    setLoading(false);\r\n  };\r\n  const fetch = async (params = {}) => {\r\n    setLoading(true);\r\n    const addactivitiesData = await apiInstance().get(\r\n      'poll?organization_id=' +\r\n      (user ? user.organization_id : 0) +\r\n      '&results=' +\r\n      params.pagination.pageSize +\r\n      '&page=' +\r\n      params.pagination.current +\r\n      '&search=' +\r\n      search +\r\n      '&sortField=' +\r\n      params.sortField +\r\n      '&sortOrder=' +\r\n      params.sortOrder +\r\n      '&filters=' +\r\n      params.filters,\r\n    );\r\n\r\n    setData(addactivitiesData.data.results);\r\n    setPagination({\r\n      ...params.pagination,\r\n      total: addactivitiesData.data.totalCount,\r\n      // 200 is mock data, you should read it from server\r\n      // total: data.totalCount,\r\n    });\r\n    setLoading(false);\r\n  };\r\n\r\n  const showModal = data => {\r\n    console.log('data deleted');\r\n    console.log(data);\r\n    setDataDelete(data);\r\n    setVisibleModalDelete(true);\r\n  };\r\n\r\n  const hideModal = () => {\r\n    setVisibleModalDelete(false);\r\n  };\r\n\r\n  const onDeleteOrganization = async () => {\r\n    // console.log('DELETE')\r\n    // const data = {\r\n    //   'organization_name': value.organization_name,\r\n    // }\r\n    // console.log(data)\r\n    const registerData = await apiInstance().delete(\r\n      'poll/' + dataDelete.poll_id,\r\n      {},\r\n    );\r\n    if (registerData.data.status == 200) {\r\n      openNotificationSuccess();\r\n      // fetchOrganizationData();\r\n      setVisibleModalDelete(false);\r\n      fetch({ pagination });\r\n    } else {\r\n      openNotificationFail(registerData.data.message);\r\n    }\r\n  };\r\n\r\n  const openNotificationSuccess = () => {\r\n    api.success({\r\n      message: `ลบข้อมูลสำเร็จ`,\r\n      description: 'ลบข้อมูลสำเร็จ',\r\n      placement: 'topRight',\r\n    });\r\n  };\r\n\r\n  const openNotificationFail = messgae => {\r\n    api.error({\r\n      message: `พบปัญหาระหว่างการบันทึกข้อมูล`,\r\n      description: messgae,\r\n      placement: 'topRight',\r\n    });\r\n  };\r\n  return (\r\n    <Layout\r\n      key={'home-poll'}\r\n      titlePage={'จัดการสำรวจความคิดเห็น'}\r\n      title=\"Government - Admin management\"\r\n      url={origin}\r\n      origin={origin}\r\n      isMain={true}\r\n      indexSubMenu={'1'}\r\n      indexMenu={'sub-1-6'}\r\n      user={login}\r\n      props={props}\r\n      _routes={[\r\n        {\r\n          path: '/admin/dashborad',\r\n          breadcrumbName: 'หน้าหลัก',\r\n        },\r\n        {\r\n          path: '/admin/management/polls',\r\n          breadcrumbName: 'จัดการสำรวจความคิดเห็น',\r\n        },\r\n      ]}\r\n    >\r\n      <div>\r\n        {contextHolder}\r\n        <div className=\"w-full lg:inline-flex justify-between\">\r\n          <div className=\"w-full lg:w-1/2 py-2 justify-center\">\r\n            <Link href=\"/admin/management/polls/add-poll\">\r\n              <a\r\n                //onClick={(e) => handleLogout(e)}\r\n                className=\"lg:inline-flex lg:w-auto px-2 py-2 rounded h-8 text-white bg-green-600 font-bold items-center justify-center hover:bg-green-600 hover:text-white\"\r\n              >\r\n                เพิ่มสำรวจความคิดเห็น\r\n              </a>\r\n            </Link>\r\n          </div>\r\n          <div className=\"text-right w-full justify-items-end lg:w-auto py-2\">\r\n            <Search placeholder=\"input search text\"\r\n              onSearch={onSearch}\r\n              enterButton\r\n              allowClear\r\n            />\r\n          </div>\r\n        </div>\r\n\r\n        <Table\r\n          columns={columns}\r\n          rowKey={record => record.poll_id}\r\n          dataSource={data}\r\n          pagination={pagination}\r\n          loading={loading}\r\n          onChange={handleTableChange}\r\n        />\r\n      </div>\r\n\r\n      <Modal\r\n        title=\"คุณต้องการลบข้อมูลหรือไม่?\"\r\n        visible={visibleModalDelete}\r\n        onOk={onDeleteOrganization}\r\n        onCancel={hideModal}\r\n        okText=\"ลบ\"\r\n        cancelText=\"ยกเลิก\"\r\n        okButtonProps={{\r\n          type: 'primary',\r\n          danger: true,\r\n        }}\r\n      >\r\n        <p>\r\n          คุณต้องการลบ \"{dataDelete ? dataDelete.poll_title : ''}\" หรือไม่?{' '}\r\n        </p>\r\n      </Modal>\r\n    </Layout>\r\n  );\r\n}\r\n/* getServerSideProps */\r\nexport async function getServerSideProps(context) {\r\n  const { req } = context;\r\n  const { origin } = absoluteUrl(req);\r\n\r\n  return {\r\n    props: {\r\n      origin,\r\n    },\r\n  };\r\n}\r\n"]},"metadata":{},"sourceType":"module"}